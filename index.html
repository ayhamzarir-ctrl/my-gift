<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For Someone Precious ğŸŒ¹</title>
    <meta name="theme-color" content="#1a0508">
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,600;1,600&family=Poppins:wght@300;500;700&family=Amiri:wght@700&family=Reenie+Beanie&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <style>
        :root {
            --primary-red: #730d1e;
            --secondary-red: #1a0508;
            --scanner-color: #00ff00;
            --heart-speed: 1.2s;
            --birthday-gold: #ffd700;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            height: 100vh; 
            background: #000; 
            overflow: hidden; 
            font-family: 'Poppins', sans-serif; 
            user-select: none;
            touch-action: none;
        }

        /* --- Preloader Styles --- */
        #preloader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999; display: flex;
            justify-content: center; align-items: center; flex-direction: column;
            transition: opacity 1s ease-out;
        }
        .loader-heart { font-size: 50px; animation: beat 1s infinite; color: var(--primary-red); }
        .loader-text { color: white; margin-top: 20px; font-family: 'Amiri'; letter-spacing: 2px; }

        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }

        /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù†Ø§Øª */
        @keyframes beat { 0%, 100% { transform: scale(1); } 15% { transform: scale(1.25); } 30% { transform: scale(1); } 45% { transform: scale(1.15); } }
        @keyframes birthdayFloat { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-20px) rotate(5deg); } }
        @keyframes glow { 0%, 100% { text-shadow: 0 0 10px #ffd700; } 50% { text-shadow: 0 0 30px #ffd700, 0 0 50px #ff6b6b; } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes moveParticle { 0% { transform: translate(0, 0) scale(1); opacity: 1; } 100% { transform: translate(var(--dx), var(--dy)) scale(0); opacity: 0; } }
        @keyframes panicShake { 0% { transform: translate(2px, 2px); } 50% { transform: translate(-2px, -2px); } 100% { transform: translate(2px, -2px); } }
        @keyframes panicFlash { 0%, 100% { background: #ff0000; } 50% { background: #660000; } }

        #heartbeat-container { position: fixed; top: 20px; left: 20px; display: none; align-items: center; gap: 10px; z-index: 1002; color: white; }
        #heart-icon { font-size: 30px; color: #ff3e3e; animation: beat var(--heart-speed) infinite ease-in-out; }
        .cursor-particle { position: fixed; pointer-events: none; font-size: 15px; z-index: 10000; animation: moveParticle 1s ease-out forwards; }
        
        .panic-mode { animation: panicShake 0.1s infinite, panicFlash 0.5s infinite !important; }

        #gatekeeper, #fingerprintScreen, #birthdayPage { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: 1s; z-index: 5000; }
        #gatekeeper { background: rgba(26, 5, 8, 0.95); }
        #fingerprintScreen { background: black; display: none; color: var(--scanner-color); }
        #birthdayPage { background: linear-gradient(135deg, #1a0508 0%, #4a0020 50%, #1a0508 100%); display: none; }
        
        .gate-card { 
            background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(20px); 
            padding: 35px; border-radius: 30px; text-align: center; 
            border: 1px solid rgba(255, 255, 255, 0.1); width: 90%; max-width: 400px; 
        }

        /* --- Custom Date Picker Styles --- */
        .date-picker-container {
            display: flex; gap: 10px; justify-content: center; margin: 20px 0;
        }
        .date-select {
            background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2);
            color: white; padding: 10px; border-radius: 10px; font-family: 'Poppins';
            outline: none; cursor: pointer; text-align: center;
        }
        .date-select option { background: #1a0508; color: white; }
        .date-select:focus { border-color: var(--primary-red); }

        /* Ø³ØªØ§ÙŠÙ„ ØµÙØ­Ø© Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ */
        .birthday-card {
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(30px);
            padding: 50px; border-radius: 40px; text-align: center;
            border: 2px solid rgba(255, 215, 0, 0.3); width: 90%; max-width: 500px;
            animation: birthdayFloat 4s infinite ease-in-out;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.2);
        }
        .birthday-title { font-family: 'Amiri'; font-size: 2.5rem; color: var(--birthday-gold); margin-bottom: 20px; animation: glow 2s infinite; }
        .birthday-date { font-size: 1.2rem; color: #ffcccc; margin-bottom: 30px; font-family: 'Playfair Display'; }
        .age-counter { display: flex; justify-content: center; gap: 20px; margin: 30px 0; }
        .age-box { background: rgba(255, 215, 0, 0.2); padding: 15px 25px; border-radius: 15px; border: 1px solid rgba(255, 215, 0, 0.5); }
        .age-number { font-size: 2rem; font-weight: bold; color: var(--birthday-gold); display: block; }
        .age-label { font-size: 0.8rem; color: #ffcccc; }
        .birthday-emoji { font-size: 4rem; animation: beat 1s infinite; display: inline-block; }

        #bottle { position: fixed; bottom: 20px; right: 20px; font-size: 40px; cursor: pointer; z-index: 100; display: none; animation: float 3s infinite; }
        #letter-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 6000; display: none; justify-content: center; align-items: center; }
        .letter-content { background: #fdf5e6; color: #5d4037; padding: 40px; width: 85%; max-width: 400px; border-radius: 5px; font-family: 'Reenie Beanie', cursive; font-size: 1.5rem; transform: rotate(-2deg); position: relative; text-align: center; }

        #main-content-wrapper { position: relative; z-index: 10; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; pointer-events: none; }
        #page1, #page2 { display: none; text-align: center; width: 90%; pointer-events: auto; }
        .btn { padding: 12px 25px; font-size: 1.1rem; border: none; border-radius: 15px; cursor: pointer; transition: 0.3s; }
        #yesBtn { background: #d63031; color: white; }
        #noBtn { background: rgba(255,255,255,0.2); color: white; position: relative; }
        #typewriter { font-family: 'Playfair Display', serif; font-size: 1.6rem; color: #ffcccc; min-height: 5rem; text-shadow: 0 0 10px rgba(255,100,100,0.5); }

        .wish-bubble {
            position: fixed; width: 60px; height: 60px; background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 50%; display: flex;
            justify-content: center; align-items: center; cursor: pointer; z-index: 50;
            font-size: 24px; backdrop-filter: blur(5px); transition: 0.5s; pointer-events: auto;
        }
        .wish-bubble:hover { transform: scale(1.2); background: rgba(255, 255, 255, 0.2); }
        #wish-display {
            position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%);
            color: #ffcccc; font-family: 'Amiri'; font-size: 1.5rem; text-align: center;
            opacity: 0; transition: 1s; z-index: 60; text-shadow: 0 0 15px #ff0055;
        }

        #backBtn {
            position: fixed; top: 20px; left: 20px; z-index: 1001;
            background: rgba(255, 215, 0, 0.3); border: 1px solid var(--birthday-gold);
            color: var(--birthday-gold); padding: 10px 20px; border-radius: 20px;
            cursor: pointer; display: none; font-family: 'Amiri';
        }
        #backBtn:hover { background: rgba(255, 215, 0, 0.5); }
    </style>
</head>
<body id="mainBody">

    <!-- Preloader -->
    <div id="preloader">
        <div class="loader-heart">â¤ï¸</div>
        <div class="loader-text">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù…ÙØ§Ø¬Ø£Ø©...</div>
    </div>

    <div id="canvas-container"></div>
    <div id="wish-display"></div>

    <audio id="bgMusic" loop>
        <source src="https://www.bensound.com/bensound-music/bensound-memories.mp3" type="audio/mpeg">
    </audio>

    <div id="heartbeat-container">
        <div id="heart-icon">â¤ï¸</div>
        <div id="bpm-text">BPM: <span id="bpm-val">72</span></div>
    </div>

    <div id="panicBtn" onclick="triggerPanic()" style="position:fixed; top:20px; right:20px; z-index:1001; font-size:24px; display:none; cursor:pointer;">ğŸš¨</div>

    <!-- Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="gatekeeper">
        <div id="visit-counter" style="position: absolute; top: 20px; left: 20px; color: white; font-family: monospace; opacity: 0.7; font-size: 1.2rem;">
            ğŸ‘ï¸ <span id="visit-count">0</span>
        </div>
        <div class="gate-card">
            <h1 style="color: white; font-family: 'Amiri'; margin-bottom: 20px;">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª â¤ï¸</h1>
            <p style="color: #ffcccc; margin-bottom: 15px; font-size: 0.9rem;">Ø£Ø¯Ø®Ù„ÙŠ ØªØ§Ø±ÙŠØ® Ù…Ù…ÙŠØ² Ù„Ù„Ø¯Ø®ÙˆÙ„</p>
            
            <!-- Custom Date Picker -->
            <div class="date-picker-container">
                <select id="daySelect" class="date-select"><option value="">ÙŠÙˆÙ…</option></select>
                <select id="monthSelect" class="date-select"><option value="">Ø´Ù‡Ø±</option></select>
                <select id="yearSelect" class="date-select"><option value="">Ø³Ù†Ø©</option></select>
            </div>

            <button class="btn" style="background: #d63031; color: white; width: 100%;" onclick="checkDate()">ÙØªØ­ Ø§Ù„Ù‚ÙÙ„</button>
            <p id="dateError" style="color: #ff6b6b; margin-top: 10px; display: none;">Ø§Ù„ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ­ÙŠØ­ØŒ Ø­Ø§ÙˆÙ„ÙŠ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ğŸ’”</p>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨ØµÙ…Ø© -->
    <div id="fingerprintScreen">
        <div style="position: relative; width: 120px; height: 150px; border: 2px solid rgba(0,255,0,0.3); border-radius: 20px; overflow: hidden;" 
             onmousedown="startScan()" onmouseup="stopScan()" ontouchstart="startScan()" ontouchend="stopScan()">
            <div style="font-size: 80px; text-align: center; opacity: 0.3; padding-top: 20px;">ğŸ‘</div>
            <div id="scanLine" style="position: absolute; top: 0; left: 0; width: 100%; height: 5px; background: #00ff00; box-shadow: 0 0 10px #00ff00; display: none;"></div>
        </div>
        <p style="margin-top: 20px; font-family: monospace;">Ø«Ø¨ØªÙŠ Ø¥ØµØ¨Ø¹Ùƒ Ù„Ù„ØªØ­Ù‚Ù‚...</p>
    </div>

    <!-- ØµÙØ­Ø© Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ Ø§Ù„Ø®Ø§ØµØ© -->
    <div id="birthdayPage">
        <button id="backBtn" onclick="backToGate()">ğŸšª Ø¹ÙˆØ¯Ø©</button>
        <div class="birthday-card">
            <div class="birthday-emoji">ğŸ‚</div>
            <h1 class="birthday-title">Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ Ø³Ø¹ÙŠØ¯!</h1>
            <p class="birthday-date">10 Ù…Ø§Ø±Ø³ 2007 ğŸŒŸ</p>
            <p style="color: #ffcccc; font-family: 'Amiri'; margin-bottom: 20px;">ÙŠÙˆÙ… ÙˆÙ„Ø¯ ÙÙŠÙ‡ Ø£Ø¬Ù…Ù„ Ø®Ù„Ù‚ Ø§Ù„Ù„Ù‡ â¤ï¸</p>
            
            <div class="age-counter">
                <div class="age-box">
                    <span class="age-number" id="ageYears">0</span>
                    <span class="age-label">Ø³Ù†Ø©</span>
                </div>
                <div class="age-box">
                    <span class="age-number" id="ageMonths">0</span>
                    <span class="age-label">Ø´Ù‡Ø±</span>
                </div>
                <div class="age-box">
                    <span class="age-number" id="ageDays">0</span>
                    <span class="age-label">ÙŠÙˆÙ…</span>
                </div>
            </div>
            
            <p style="color: var(--birthday-gold); font-family: 'Reenie Beanie'; font-size: 1.8rem; margin-top: 20px;">
                ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†ØªÙ Ø¨Ø®ÙŠØ± ÙŠØ§ Ø£ØºÙ„Ù‰ Ø¥Ù†Ø³Ø§Ù†Ø© ğŸŒ¹
            </p>
            
            <button class="btn" style="background: var(--birthday-gold); color: #1a0508; margin-top: 20px;" onclick="celebrateBirthday()">ğŸ‰ Ø§Ø­ØªÙØ§Ù„!</button>
        </div>
    </div>

    <div id="bottle" onclick="openLetter()">ğŸ¾</div>
    <div id="letter-modal">
        <div class="letter-content">
            <span style="position: absolute; top: 10px; right: 15px; cursor: pointer;" onclick="closeLetter()">Ã—</span>
            <p>Ù„Ù‚Ø¯ Ù…Ø±Ù‘ Ø¹Ù„Ù‰ ØªØ§Ø±ÙŠØ®Ù†Ø§ Ø§Ù„Ù…Ù…ÙŠØ²:</p>
            <div id="time-counter" style="margin: 15px 0; font-weight: bold; color: #d63031;"></div>
            <p>Ø§Ø¨ØªØ³Ø§Ù…ØªÙƒ Ù‡ÙŠ Ø§Ù„Ø³Ø± ÙˆØ±Ø§Ø¡ Ø¬Ù…Ø§Ù„ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹.. â¤ï¸</p>
        </div>
    </div>

    <div id="main-content-wrapper">
        <div id="page1">
            <h1 style="color: white;">Ready to see more?</h1>
            <div style="display: flex; justify-content: center; gap: 15px; margin-top: 20px;">
                <button class="btn" id="yesBtn" onclick="initiateSequence()">Yes â¤ï¸</button>
                <button class="btn" id="noBtn" onmouseover="teleport()">No ğŸ˜‚</button>
            </div>
        </div>
        <div id="page2">
            <div id="typewriter"></div>
            <div id="finalMsg" style="color: white; font-size: 2rem; opacity: 0; transition: 2s;">Ø£Ø±Ø§Ù…ÙŠ... <br> Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙŠ Ù„Ø£Ù†ÙƒÙ Ù…ÙˆØ¬ÙˆØ¯Ø© â¤ï¸</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script>
        // --- Preloader Logic ---
        window.addEventListener('load', () => {
            const preloader = document.getElementById('preloader');
            setTimeout(() => {
                preloader.style.opacity = '0';
                setTimeout(() => { preloader.style.display = 'none'; }, 1000);
            }, 2000); // Show for 2 seconds
            
            initThree();
            let count = localStorage.getItem('site_visits') || 0;
            count = parseInt(count) + 1;
            localStorage.setItem('site_visits', count);
            document.getElementById('visit-count').innerText = count;
            
            // Populate Date Pickers
            populateDatePickers();
            
            // Register Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                .then(() => console.log('Service Worker Registered'));
            }
        });

        // --- Date Picker Population ---
        function populateDatePickers() {
            const daySelect = document.getElementById('daySelect');
            const monthSelect = document.getElementById('monthSelect');
            const yearSelect = document.getElementById('yearSelect');

            for (let i = 1; i <= 31; i++) {
                let opt = document.createElement('option');
                opt.value = i < 10 ? '0' + i : i;
                opt.innerHTML = i;
                daySelect.appendChild(opt);
            }

            const months = ["ÙŠÙ†Ø§ÙŠØ±", "ÙØ¨Ø±Ø§ÙŠØ±", "Ù…Ø§Ø±Ø³", "Ø£Ø¨Ø±ÙŠÙ„", "Ù…Ø§ÙŠÙˆ", "ÙŠÙˆÙ†ÙŠÙˆ", "ÙŠÙˆÙ„ÙŠÙˆ", "Ø£ØºØ³Ø·Ø³", "Ø³Ø¨ØªÙ…Ø¨Ø±", "Ø£ÙƒØªÙˆØ¨Ø±", "Ù†ÙˆÙÙ…Ø¨Ø±", "Ø¯ÙŠØ³Ù…Ø¨Ø±"];
            for (let i = 0; i < 12; i++) {
                let opt = document.createElement('option');
                opt.value = i < 9 ? '0' + (i + 1) : (i + 1);
                opt.innerHTML = months[i];
                monthSelect.appendChild(opt);
            }

            for (let i = 2000; i <= 2025; i++) {
                let opt = document.createElement('option');
                opt.value = i;
                opt.innerHTML = i;
                yearSelect.appendChild(opt);
            }
        }

        // --- Three.js Engine ---
        let scene, camera, renderer, stars, heart3D, mouseX = 0, mouseY = 0;
        
        function initThree() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            const starGeometry = new THREE.BufferGeometry();
            const starMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.5 });
            const starVertices = [];
            for (let i = 0; i < 10000; i++) {
                starVertices.push((Math.random() - 0.5) * 2000, (Math.random() - 0.5) * 2000, (Math.random() - 0.5) * 2000);
            }
            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
            stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);

            for(let i=0; i<5; i++) {
                const spriteMaterial = new THREE.SpriteMaterial({
                    map: createNebulaTexture(),
                    color: i % 2 === 0 ? 0x730d1e : 0x4a0082,
                    transparent: true,
                    opacity: 0.15
                });
                const sprite = new THREE.Sprite(spriteMaterial);
                sprite.scale.set(400, 400, 1);
                sprite.position.set(Math.random()*200-100, Math.random()*200-100, -200);
                scene.add(sprite);
            }

            const heartShape = new THREE.Shape();
            heartShape.moveTo(0, 0);
            heartShape.bezierCurveTo(0, 0, -5, 5, -15, 5);
            heartShape.bezierCurveTo(-35, 5, -35, -22.5, -35, -22.5);
            heartShape.bezierCurveTo(-35, -45, -15, -60, 0, -80);
            heartShape.bezierCurveTo(15, -60, 35, -45, 35, -22.5);
            heartShape.bezierCurveTo(35, -22.5, 35, 5, 15, 5);
            heartShape.bezierCurveTo(5, 5, 0, 0, 0, 0);

            const geometry = new THREE.ExtrudeGeometry(heartShape, { depth: 10, bevelEnabled: true, bevelSize: 2, bevelThickness: 2 });
            const material = new THREE.MeshPhongMaterial({ color: 0xff0033, shininess: 100 });
            heart3D = new THREE.Mesh(geometry, material);
            heart3D.scale.set(0.18, 0.18, 0.18);
            heart3D.rotation.z = Math.PI;
            heart3D.position.set(0, 0, -100);
            scene.add(heart3D);

            scene.add(new THREE.PointLight(0xffffff, 2, 500));
            scene.add(new THREE.AmbientLight(0x404040, 1));
            camera.position.z = 1000;
            animateThree();
        }

        function createNebulaTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 128; canvas.height = 128;
            const ctx = canvas.getContext('2d');
            const grad = ctx.createRadialGradient(64, 64, 0, 64, 64, 64);
            grad.addColorStop(0, 'rgba(255,255,255,1)');
            grad.addColorStop(1, 'rgba(255,255,255,0)');
            ctx.fillStyle = grad; ctx.fillRect(0,0,128,128);
            const tex = new THREE.Texture(canvas);
            tex.needsUpdate = true; return tex;
        }

        function animateThree() {
            requestAnimationFrame(animateThree);
            stars.rotation.y += 0.0005;
            stars.rotation.x += (mouseY * 0.0001);
            stars.rotation.y += (mouseX * 0.0001);

            const pulse = 0.18 + Math.sin(Date.now() * 0.005) * 0.02;
            heart3D.scale.set(pulse, pulse, pulse);
            heart3D.rotation.y += 0.01;

            if (camera.position.z > 250) camera.position.z -= 2;
            renderer.render(scene, camera);
        }

        // --- Wishes System ---
        const wishes = ["Ø£ØªÙ…Ù†Ù‰ Ù„ÙƒÙ Ø³Ø¹Ø§Ø¯Ø© Ù„Ø§ ØªÙ†ØªÙ‡ÙŠ âœ¨", "Ø£Ù…Ù†ÙŠØ© Ø¨Ø£Ù† ØªØ¨Ù‚ÙŠ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¨Ø¬Ø§Ù†Ø¨ÙŠ â¤ï¸", "Ø£ØªÙ…Ù†Ù‰ Ø£Ù† ØªØªØ­Ù‚Ù‚ ÙƒÙ„ Ø£Ø­Ù„Ø§Ù…Ùƒ Ø§Ù„ÙƒØ¨ÙŠØ±Ø© ğŸŒ ", "Ø£Ù…Ù†ÙŠØ© Ø¨ÙŠÙˆÙ… Ù…Ù„ÙŠØ¡ Ø¨Ø§Ù„Ø¶Ø­Ùƒ ğŸŒ¸"];
        function spawnWishBubble() {
            const b = document.createElement('div');
            b.className = 'wish-bubble'; b.innerHTML = 'ğŸ';
            b.style.left = Math.random() * 80 + 10 + 'vw';
            b.style.top = '110vh';
            document.body.appendChild(b);

            let pos = 110;
            const move = setInterval(() => {
                pos -= 0.5; b.style.top = pos + 'vh';
                if (pos < -10) { clearInterval(move); b.remove(); }
            }, 30);

            b.onclick = () => {
                const display = document.getElementById('wish-display');
                display.innerText = wishes[Math.floor(Math.random() * wishes.length)];
                display.style.opacity = '1';
                b.innerHTML = 'âœ¨';
                setTimeout(() => display.style.opacity = '0', 3000);
                confetti({ particleCount: 50, spread: 70, origin: { y: 0.8 } });
            };
        }

        function startWishes() { setInterval(spawnWishBubble, 5000); }

        // --- Main Logic ---
        const audio = document.getElementById("bgMusic");
        audio.volume = 0.2;

        const BIRTHDAY_DATE = "2007-03-10";
        const SPECIAL_DATE = "2025-10-24";

        window.addEventListener('mousemove', (e) => {
            mouseX = (e.clientX - window.innerWidth/2);
            mouseY = (e.clientY - window.innerHeight/2);
            if (Math.random() > 0.85) createParticle(e.clientX, e.clientY);
        });

        function checkDate() {
            const day = document.getElementById('daySelect').value;
            const month = document.getElementById('monthSelect').value;
            const year = document.getElementById('yearSelect').value;
            const errorMsg = document.getElementById('dateError');
            
            if (!day || !month || !year) {
                errorMsg.innerText = "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® ÙƒØ§Ù…Ù„Ø§Ù‹ ğŸ’”";
                errorMsg.style.display = 'block';
                return;
            }

            const selectedDate = `${year}-${month}-${day}`;
            
            if (selectedDate === BIRTHDAY_DATE) {
                errorMsg.style.display = 'none';
                document.getElementById('gatekeeper').style.display = 'none';
                document.getElementById('birthdayPage').style.display = 'flex';
                document.getElementById('backBtn').style.display = 'block';
                calculateAge();
                celebrateBirthday();
            } else if (selectedDate === SPECIAL_DATE) {
                errorMsg.style.display = 'none';
                document.getElementById('gatekeeper').style.display = 'none';
                document.getElementById('fingerprintScreen').style.display = 'flex';
            } else {
                errorMsg.innerText = "Ø§Ù„ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ­ÙŠØ­ØŒ Ø­Ø§ÙˆÙ„ÙŠ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ğŸ’”";
                errorMsg.style.display = 'block';
            }
        }

        function calculateAge() {
            const birthDate = new Date(BIRTHDAY_DATE);
            const today = new Date();
            
            let years = today.getFullYear() - birthDate.getFullYear();
            let months = today.getMonth() - birthDate.getMonth();
            let days = today.getDate() - birthDate.getDate();
            
            if (days < 0) {
                months--;
                days += new Date(today.getFullYear(), today.getMonth(), 0).getDate();
            }
            if (months < 0) {
                years--;
                months += 12;
            }
            
            document.getElementById('ageYears').innerText = years;
            document.getElementById('ageMonths').innerText = months;
            document.getElementById('ageDays').innerText = days;
        }

        function celebrateBirthday() {
            for(let i = 0; i < 5; i++) {
                setTimeout(() => {
                    confetti({
                        particleCount: 150, spread: 100, origin: { y: 0.6 },
                        colors: ['#ffd700', '#ff6b6b', '#ffffff', '#ff1493']
                    });
                }, i * 300);
            }
        }

        function backToGate() {
            document.getElementById('birthdayPage').style.display = 'none';
            document.getElementById('gatekeeper').style.display = 'flex';
            document.getElementById('backBtn').style.display = 'none';
        }

        function startScan() {
            audio.play(); document.getElementById('scanLine').style.display = 'block';
            setTimeout(() => {
                document.getElementById('fingerprintScreen').style.display = 'none';
                document.getElementById('page1').style.display = 'block';
                document.getElementById('bottle').style.display = 'block';
                document.getElementById('heartbeat-container').style.display = 'flex';
                document.getElementById('panicBtn').style.display = 'block';
                startWishes();
            }, 3000);
        }

        function stopScan() { document.getElementById('scanLine').style.display = 'none'; }
        function openLetter() { document.getElementById('letter-modal').style.display = 'flex'; }
        function closeLetter() { document.getElementById('letter-modal').style.display = 'none'; }
        function teleport() { const btn = document.getElementById('noBtn'); btn.style.position="fixed"; btn.style.left=Math.random()*80+"vw"; btn.style.top=Math.random()*80+"vh"; }
        function initiateSequence() { document.getElementById('page1').style.display = 'none'; document.getElementById('page2').style.display = 'block'; startStory(); }
        
        const lines = ["I know things might be different...", "But some people are just too special to let go.", "Stay amazing, just the way you are."];
        let lIdx = 0, cIdx = 0;
        function startStory() {
            const box = document.getElementById('typewriter');
            if (cIdx < lines[lIdx].length) { box.innerHTML += lines[lIdx].charAt(cIdx++); setTimeout(startStory, 50); } 
            else { setTimeout(nextPart, 2000); }
        }
        function nextPart() {
            const box = document.getElementById('typewriter');
            if (cIdx > 0) { box.innerHTML = lines[lIdx].substring(0, --cIdx); setTimeout(nextPart, 30); } 
            else { lIdx++; if (lIdx < lines.length) setTimeout(startStory, 500); else { document.getElementById('finalMsg').style.opacity = '1'; } }
        }

        function createParticle(x, y) {
            const p = document.createElement('div');
            p.className = 'cursor-particle'; p.innerHTML = 'âœ¨';
            p.style.left = x + 'px'; p.style.top = y + 'px';
            p.style.setProperty('--dx', (Math.random()-0.5)*200+'px');
            p.style.setProperty('--dy', (Math.random()-0.5)*200+'px');
            document.body.appendChild(p);
            setTimeout(() => p.remove(), 1000);
        }

        setInterval(() => {
            const diff = new Date() - new Date("2025-10-24T00:00:00");
            const days = Math.floor(diff / 86400000);
            document.getElementById('time-counter').innerHTML = `${days} ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ù„Ø­Ø¸Ø§Øª Ø§Ù„Ø¬Ù…ÙŠÙ„Ø©`;
        }, 1000);

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
